# 한국투자증권 API 자동매매 프로그램 개발 할일 목록

## 🎯 프로젝트 개요
**목표**: KIS OpenAPI를 활용한 자동매매 프로그램 MVP (3주 개발)
**핵심 검증**: WebSocket 실시간 데이터 + RSI 기반 매매전략 유효성

---

## 📋 Phase 1: 기반 인프라 구축 (Week 1)
**목표**: KIS API 연동 및 기본 데이터 수집 시스템

### 1.1 프로젝트 설정 (Day 1-2) ⭐
**목표**: 기반 프로젝트 구조 및 환경 설정 완료 (4-6시간)

#### 🎯 5단계 요약
1. **디렉터리 구조** (1시간): `src/`, `tests/`, `config/`, `data/` 등 체계적 구조
2. **uv 설정** (30분): `pyproject.toml` + `uv sync --extra dev` (venv 대신 uv 사용!)
3. **환경변수** (30분): `.env.example` (KIS API 키, 전략 파라미터)
4. **설정 파일** (30분): `config.yaml`, `logging.yaml`
5. **기본 파일** (1시간): `.gitignore`, `README.md`, `run.py`

#### 📋 체크리스트
- [x] 1.1.1 디렉터리 구조 생성
- [x] 1.1.2 uv 설치 및 `pyproject.toml` 작성  
- [x] 1.1.3 환경변수 설정 (`.env.example` 작성)
- [x] 1.1.4 설정 파일 구성 (`config.yaml`, `logging.yaml`)
- [x] 1.1.5 기본 파일 생성 (`.gitignore`, `README.md`, `run.py`)

**📖 자세한 구현 가이드**: [Phase1_1_ProjectSetup_Detailed.md](Phase1_1_ProjectSetup_Detailed.md)

### 1.2 KIS API 인증 시스템 (Day 3-4) ⭐
**목표**: OAuth2 토큰 관리 + Rate Limiter 시스템 완성 (3-4시간)

#### 🎯 4단계 요약  
1. **KISAuthManager 설계** (2시간): 토큰 발급/갱신/저장, 실전/모의투자 분리
2. **Rate Limiter 구현** (1시간): 초당 20건 제한, 지수 백오프, 우선순위 큐
3. **HTTP Client 래퍼** (30분): aiohttp 기반 API 호출 래퍼
4. **단위 테스트** (30분): Mock 기반 테스트 케이스

#### 📋 핵심 함수 구조
```python
# KISAuthManager 핵심 메서드
- get_access_token() -> str              # 토큰 조회 (자동갱신)
- get_websocket_approval_key() -> str    # WebSocket 인증키
- _issue_new_token() -> TokenInfo        # 새 토큰 발급
- _save_token_to_file() -> None          # 토큰 저장
- _is_token_valid() -> bool              # 만료 체크

# RateLimiter 핵심 메서드  
- acquire(priority=0) -> None            # Rate limit 체크 & 대기
- get_remaining_calls() -> int           # 남은 호출 횟수
- _calculate_wait_time() -> float        # 대기시간 계산
```

#### 📋 체크리스트
- [x] 1.2.1 KISAuthManager 클래스 설계 (데이터 모델 + 예외 클래스)
- [x] 1.2.2 Rate Limiter 구현 (초당 20건 제한 + 지수 백오프)
- [x] 1.2.3 HTTP Client 래퍼 (aiohttp 기반)
- [x] 1.2.4 단위 테스트 작성 - **TDD 완료 (27개 테스트 통과)**

**📖 자세한 구현 가이드**: [Phase1_2_KISAuth_Detailed.md](Phase1_2_KISAuth_Detailed.md)

### 1.3 실시간 데이터 시스템 구축 (Day 5-7) ⭐
- [ ] **WebSocket Handler 구현** (핵심!)
  - [ ] WebSocket 연결 및 인증 (`auth_ws()`)
  - [ ] 실시간 호가 구독 (`H0STASP0`)
  - [ ] 실시간 체결 구독 (`H0STCNT0`)
  - [ ] 재연결 로직 및 에러 처리
- [ ] `MarketDataManager` 구현
  - [ ] REST API 일봉 차트 조회
  - [ ] WebSocket 실시간 데이터 처리
  - [ ] 실시간 분봉 데이터 생성기
  - [ ] 데이터 캐싱 및 메모리 관리
- [ ] SQLite 데이터베이스 설정
  - [ ] 테이블 스키마 생성 (stocks, daily_chart, minute_chart, realtime_quotes, etc.)
  - [ ] 비동기 데이터베이스 접근 (`aiosqlite`)
- [ ] 기본 로깅 시스템 구축 (`loguru`)

---

## 📈 Phase 2: 매매전략 및 주문시스템 (Week 2)
**목표**: RSI 전략 구현 및 주문 실행 시스템

### 2.1 실시간 매매전략 엔진 (Day 8-10)
- [ ] 기술적 지표 계산 시스템
  - [ ] TA-Lib 연동 및 RSI, 이동평균 구현
  - [ ] 데이터 검증 및 예외 처리
- [ ] **실시간 RSI Strategy 클래스 구현** ⭐
  - [ ] 기술적 분석 (차트 데이터 기반)
  - [ ] **실시간 호가창 분석** (WebSocket 데이터 활용)
  - [ ] 호가 스프레드율, 매수/매도 물량 압박 분석
  - [ ] 복합 시그널 생성 (기술적 분석 + 실시간 판단)
  - [ ] 시그널 강도 및 매매 근거 로깅
- [ ] 백테스팅 시스템 구현
  - [ ] 과거 데이터 기반 전략 성과 측정
  - [ ] 실시간 시뮬레이션 모드

### 2.2 주문 실행 시스템 (Day 11-14)
- [ ] `TradingEngine` 클래스 구현
  - [ ] 현금 주문 실행 (`order-cash` API)
  - [ ] 주문 취소/정정 기능
  - [ ] 주문 상태 추적 및 체결 확인
  - [ ] 포지션 실시간 업데이트
- [ ] `RiskManager` 클래스 구현
  - [ ] 포지션 크기 제한 (종목당 최대 10%)
  - [ ] 손절/익절 자동 실행 (-5%/+10%)
  - [ ] 일일 최대 손실 관리 (-3%)
  - [ ] 거래 빈도 제한
- [ ] 계좌 및 잔고 관리
  - [ ] 실시간 포지션 조회
  - [ ] 계좌 평가 잔고 업데이트
  - [ ] 매매 가능 금액 계산
- [ ] 모의 주문 시스템으로 전략 검증

---

## 🔧 Phase 3: 운영 시스템 (Week 3)
**목표**: 실시간 모니터링 및 안정화

### 3.1 실시간 운영 시스템 (Day 15-17)
- [ ] 스케줄링 시스템 구현
  - [ ] 장 운영시간 체크 (9:00-15:30)
  - [ ] 전략 실행 스케줄 관리
  - [ ] 시스템 자동 시작/종료
- [ ] 실시간 매매 루프 구현
  - [ ] 메인 매매 로직 통합
  - [ ] 다중 종목 동시 모니터링
  - [ ] 실시간 포지션 관리
- [ ] 에러 처리 및 복구 로직
  - [ ] API 장애 대응 방안
  - [ ] 네트워크 연결 끊김 처리
  - [ ] 예외 상황 자동 복구
- [ ] 알림 시스템 구현
  - [ ] 텔레그램 봇 연동
  - [ ] 매매 신호 및 체결 알림
  - [ ] 에러 발생 긴급 알림

### 3.2 모니터링 및 최적화 (Day 18-21)
- [ ] 실시간 대시보드 구현
  - [ ] 실시간 수익률 및 포지션 현황
  - [ ] 매매 전략 성과 분석
  - [ ] API 호출 현황 모니터링
- [ ] **성능 최적화**
  - [ ] **API 호출 횟수 최적화** (Rate Limit 준수)
  - [ ] **캐싱 전략 개선** (불필요한 호출 제거)
  - [ ] 메모리 사용량 최적화
  - [ ] 응답시간 개선
- [ ] 시스템 안정성 개선
  - [ ] 헬스체크 시스템 구현
  - [ ] 자동 재시작 메커니즘
  - [ ] 로그 분석 및 모니터링
- [ ] 최종 검증 및 분석
  - [ ] 백테스팅 결과 vs 실제 결과 비교
  - [ ] 전략 성과 평가 및 개선점 도출
  - [ ] MVP 성공 지표 달성 확인

---

## 🎯 성공 지표 (KPI)

### 기술적 지표
- [ ] API 응답시간 평균 < 500ms
- [ ] 시스템 가동율 > 99% (장중)
- [ ] 시세 데이터 오차 < 0.1%
- [ ] API Rate Limit 위반 < 1%
- [ ] 캐시 적중률 > 80%

### 재무적 지표
- [ ] 최소 연 5% 수익률 목표
- [ ] 일일 최대 손실 -3% 제한
- [ ] 거래 비용 < 수익의 30%

### 운영 지표
- [ ] 매매 빈도 주 2-5회
- [ ] 신호 정확도 > 60%
- [ ] 에러 발생률 < 1%

---

## 🚨 리스크 관리 체크리스트

### 기술적 리스크
- [ ] API 장애 대응 프로세스 구비
- [ ] Rate Limit 초과 방지 메커니즘
- [ ] 네트워크 지연 타임아웃 설정
- [ ] 데이터 오류 다중 검증 시스템
- [ ] 토큰 만료 자동 갱신 로직

### 재무적 리스크
- [ ] 스톱로스 자동 실행 시스템
- [ ] 거래량 체크 후 주문
- [ ] 일일 거래 횟수 제한

### 운영 리스크
- [ ] 시스템 다운 자동 대응
- [ ] 실시간 성과 모니터링
- [ ] 금융당국 규정 준수

---

## 📝 개발 우선순위

### 🔴 High Priority (핵심 기능)
1. WebSocket 실시간 데이터 수집
2. RSI + 실시간 호가 분석 전략
3. 주문 실행 시스템
4. 리스크 관리 시스템

### 🟡 Medium Priority (중요 기능)
1. 백테스팅 시스템
2. 알림 시스템
3. 모니터링 대시보드
4. 성능 최적화

### 🟢 Low Priority (부가 기능)
1. 다중 전략 지원
2. 웹 인터페이스
3. 고급 분석 기능
4. 확장성 개선

---

## ⏰ 타임라인 요약

**Week 1** (Phase 1): 기반 시스템 구축 → WebSocket 실시간 데이터 수집  
**Week 2** (Phase 2): 매매 로직 구현 → 실시간 RSI 전략 + 주문 시스템  
**Week 3** (Phase 3): 운영 안정화 → 모니터링 + 성과 검증

**최종 목표**: 실시간 데이터 활용으로 기존 대비 **20-30% 성과 향상**